<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Performance - Spencer Advogados</title>
    <!-- Carregando Tailwind CSS para Estiliza√ß√£o -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // PALETA PROFISSIONAL (CORES RESTAURADAS)
                        'primary-dark': '#441615',    // Bord√¥ Profundo
                        'accent-light': '#ded2b7',    // Creme/Beige S√≥brio (Fundo da P√°gina)
                        'background-base': '#F9FAFB', // Fundo dos Cards (Cinza Claro)
                        
                        // Cores das Tags (AJUSTADAS PARA SUTILEZA CORPORATIVA)
                        'tag-cumprido': '#1D7A4F',    // Verde Sutil (Borda e Texto)
                        'tag-parcial': '#B47F0C',     // Ouro Sutil (Borda e Texto)
                        'tag-falhou': '#A31F2A',      // Vermelho Sutil (Borda e Texto)
                        
                        // Cores de fundo dos bal√µes
                        'status-bg-cumprido': '#1D7A4F',    
                        'status-bg-parcial': '#B47F0C',     
                        'status-bg-falhou': '#A31F2A',      
                        'status-bg-razoavel': '#607d8b',    // Novo: Azul/Cinza Neutro para Razo√°vel
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        /* Estilos customizados para o container principal e inputs */
        .card-shadow {
            /* Sombra mais pronunciada para o painel principal */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.07), 0 4px 6px -2px rgba(0, 0, 0, 0.04);
        }
        .input-box {
            border-radius: 0.75rem; 
            border: 1px solid #D1D5DB;
            padding: 0.8rem 1.25rem;
            width: 100%;
            transition: all 0.2s;
        }
        .input-box:focus {
            box-shadow: 0 0 0 4px rgba(68, 22, 21, 0.1); 
            outline: none;
        }
        
        /* Estilos da Navega√ß√£o por Abas (Mantidos) */
        .tab-button {
            @apply px-6 py-2 text-base font-bold rounded-xl transition-all duration-300 focus:outline-none;
            @apply bg-white text-gray-700 hover:bg-gray-200 shadow-md;
            border-bottom: none !important;
        }
        .tab-button.active {
            @apply bg-primary-dark text-white shadow-xl;
        }
        .tab-button:focus-visible {
            @apply ring-4 ring-primary-dark/30;
        }
        
        /* Cores de status para os bal√µes */
        .status-1 { @apply bg-status-bg-cumprido text-white font-semibold; }
        .status-05 { @apply bg-status-bg-parcial text-white font-semibold; } 
        .status-0 { @apply bg-status-bg-falhou text-white font-semibold; }
        
        /* Estilo para o bot√£o principal com efeito moderno de eleva√ß√£o */
        .main-button {
            @apply transition-all duration-300 transform hover:-translate-y-0.5 hover:shadow-xl;
        }

        /* Estilo para o dropdown de N√≠vel de Cumprimento (Pilar 2) */
        .custom-select-wrapper {
            @apply relative inline-block w-full max-w-[160px]; 
        }

        .custom-select {
            @apply input-box p-2 text-sm max-w-full appearance-none cursor-pointer rounded-lg bg-white border-2 transition-colors duration-200; 
            padding-top: 0.5rem;
            padding-bottom: 0.5rem;
            padding-left: 0.5rem;
            padding-right: 2.5rem !important; 
            background-image: none;
            /* Adicionado para garantir a remo√ß√£o da seta padr√£o do browser */
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }

        .custom-select-icon {
            @apply pointer-events-none absolute inset-y-0 right-0 flex items-center pr-2 text-gray-700;
        }
        
        /* Estilos de Impress√£o (Mantidos) */
        @media print {
            body > header, 
            body > nav, 
            body > #calculator-view { 
                display: none !important; 
            }
            body { 
                padding: 0; 
                margin: 0; 
                background: white;
            }
            #report-view {
                display: block !important;
                width: 100% !important;
                max-width: none !important;
                padding: 0 !important;
            }
            #feedback-customization-form,
            .print-hidden { 
                display: none !important; 
            }
            #report-preview-content {
                border-top: none !imporant;
                padding-top: 0 !important;
            }
            .text-7xl { font-size: 3rem !important; } 
            .text-2xl { font-size: 1.25rem !important; }
            .text-xl { font-size: 1.1rem !important; }
            .text-lg { font-size: 1rem !important; }
        }

    </style>
</head>
<!-- FUNDO DA P√ÅGINA ATUALIZADO para a cor original 'accent-light' -->
<body class="bg-accent-light font-sans min-h-screen p-4 sm:p-8 flex justify-center items-start text-gray-800">

<div class="w-full max-w-6xl mx-auto">
    <!-- T√çTULO PRINCIPAL (Acima das abas) -->
    <header class="text-center mb-6">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-primary-dark tracking-tight">Painel de Performance</h1>
    </header>

    <!-- BARRA DE NAVEGA√á√ÉO POR ABAS (CLASSES ATUALIZADAS) -->
    <nav class="flex space-x-4 mb-8">
        <button id="tab-calculator" onclick="showView('calculator-view')" class="tab-button active">Calculadora</button>
        <button id="tab-report" onclick="showView('report-view')" class="tab-button">Relat√≥rio de Feedback</button>
    </nav>


    <!-- CONTE√öDO DA ABA 1: CALCULADORA (LAYOUT DE PAINEL √öNICO) -->
    <div id="calculator-view" class="w-full">
        <!-- PAINEL CENTRAL √öNICO -->
        <div class="w-full max-w-4xl mx-auto bg-background-base p-6 sm:p-8 rounded-2xl card-shadow border-t-4 border-primary-dark">
            
            <div class="space-y-10">

                <!-- SE√á√ÉO 1: Produtividade e Volume -->
                <div>
                    <h2 class="text-2xl font-bold mb-6 text-primary-dark border-b-2 border-primary-dark/30 pb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-primary-dark"><path d="M3 3v18h18"/><path d="M18.7 8l-6.7 6.7-3.3-3.4L3 18"/></svg>
                        Pilar 1: Produtividade e Volume
                    </h2>
                    
                    <!-- Conte√∫do do Pilar 1 (inputs) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start">
                        <!-- Inputs -->
                        <div class="space-y-6">
                            <!-- Meta Semanal -->
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2" for="meta-semanal">Meta Semanal de Pontos (MSP):</label>
                                <input type="number" id="meta-semanal" value="0" min="1" class="input-box text-2xl font-bold text-primary-dark bg-white">
                                <p class="text-xs text-gray-500 mt-1">Pontua√ß√£o alvo para performance em volume.</p>
                            </div>
                            <!-- Pontos Ganhos -->
                            <div>
                                <label class="block text-md font-medium text-gray-700 mb-2" for="pontos-ganhos">Pontos de Produtividade Ganhos (PG):</label>
                                <input type="number" id="pontos-ganhos" value="0" min="0" class="input-box text-2xl font-bold text-primary-dark bg-white">
                            </div>
                        </div>
                        
                        <!-- Resultado Parcial Pilar 1 -->
                        <div class="mt-0 md:mt-6 p-5 bg-gray-50 rounded-xl border border-gray-200 h-full flex flex-col justify-between">
                            <div>
                                <h3 class="text-lg font-medium text-primary-dark">Pontua√ß√£o Parcial de Volume (60%)</h3>
                                <div class="flex items-end justify-between mt-2">
                                    <p id="score-prod-display" class="text-4xl font-extrabold text-primary-dark">--%</p>
                                </div>
                            </div>
                            <button onclick="calculatePilar1()" class="w-full text-sm font-bold text-primary-dark bg-accent-light hover:bg-[#c9b99e] transition-all duration-300 p-2.5 rounded-lg mt-4 shadow-md focus:outline-none focus:ring-4 focus:ring-primary-dark/30">
                                Atualizar Volume
                            </button>
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 2: Indicadores de Processo e Qualidade -->
                <div>
                    <h2 class="text-2xl font-bold mb-6 text-primary-dark border-b-2 border-primary-dark/30 pb-3 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6 mr-2 text-status-bg-cumprido" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                        </svg>
                        Pilar 2: Indicadores de Processo e Qualidade
                    </h2>

                    <!-- Conte√∫do do Pilar 2 (tabela) -->
                    <div class="overflow-x-auto table-container">
                        <table class="min-w-full divide-y divide-accent-light rounded-lg overflow-hidden">
                            <thead class="bg-accent-light">
                                <tr>
                                    <th class="px-4 py-3 text-left text-sm font-bold text-primary-dark uppercase tracking-wider rounded-tl-lg w-2/3">Atribui√ß√£o de Impacto/Risco</th>
                                    <th class="px-4 py-3 text-center text-sm font-bold text-primary-dark uppercase tracking-wider w-1/3 rounded-tr-lg">N√≠vel de Cumprimento</th>
                                </tr>
                            </thead>
                            <tbody id="indicator-table-body" class="bg-white divide-y divide-gray-100">
                                <!-- Linhas de Indicadores ser√£o inseridas here via JS -->
                            </tbody>
                        </table>
                    </div>

                    <!-- Resultado Parcial Pilar 2 -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 items-start mt-6">
                        <div class="md:col-start-2"> <!-- Alinha √† direita -->
                            <div class="p-5 bg-gray-50 rounded-xl border border-gray-200 flex flex-col justify-between">
                                <div>
                                    <h3 class="text-lg font-medium text-primary-dark">Pontua√ß√£o Parcial de Qualidade (40%)</h3>
                                    <div class="flex items-end justify-between mt-2">
                                        <p id="score-indic-display" class="text-4xl font-extrabold text-primary-dark">--%</p>
                                    </div>
                                </div>
                                <button onclick="calculatePilar2()" class="w-full text-sm font-bold text-primary-dark bg-accent-light hover:bg-[#c9b99e] transition-all duration-300 p-2.5 rounded-lg mt-4 shadow-md focus:outline-none focus:ring-4 focus:ring-primary-dark/30">
                                    Atualizar Qualidade
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- SE√á√ÉO 3: Resultado Final e A√ß√µes -->
                <div class="pt-6 border-t border-gray-200 space-y-8">
                    
                    <!-- Resultado Final (Centralizado) -->
                    <div class="max-w-xl mx-auto">
                        <div id="pfd-box" class="p-8 text-center rounded-2xl shadow-xl transition-all duration-300 ease-in-out" style="display: none;">
                            <p class="text-xl font-medium opacity-90">Desempenho Semanal Total:</p>
                            <p id="pfd-display" class="text-7xl font-extrabold mt-2"></p>
                            <p id="pfd-status" class="text-lg mt-4 font-semibold"></p>
                        </div>
                        <div id="report-link-info" class="mt-6 text-center text-sm font-medium text-gray-600" style="display: none;">
                            <p>‚úÖ C√°lculo Conclu√≠do. V√° para a aba <button onclick="showView('report-view')" class="text-primary-dark font-bold hover:underline">Relat√≥rio de Feedback</button> para personalizar e gerar o documento.</p>
                        </div>
                    </div>

                    <!-- Bot√µes de A√ß√£o (Limpar e Calcular) -->
                    <div class="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-6 px-2">
                        <button onclick="resetAll()" class="w-full sm:w-1/4 text-base font-bold text-primary-dark bg-accent-light hover:bg-[#c9b99e] transition-all duration-300 p-3 rounded-xl shadow-md main-button focus:outline-none focus:ring-4 focus:ring-primary-dark/30">
                            LIMPAR TUDO
                        </button>
                        <button onclick="calculateFinal()" class="w-full sm:w-1/3 text-xl font-bold text-white bg-primary-dark hover:bg-[#2e1010] transition-all duration-300 p-3 rounded-xl shadow-xl main-button focus:outline-none focus:ring-4 focus:ring-primary-dark/50">
                            CALCULAR AVALIA√á√ÉO FINAL
                        </button>
                    </div>

                </div>

            </div> <!-- Fim do space-y-10 -->
        </div> <!-- Fim do painel central √∫nico -->
    </div>


    <!-- CONTE√öDO DA ABA 2: RELAT√ìRIO DE FEEDBACK (Mant√©m o layout de card √∫nico) -->
    <div id="report-view" class="w-full" style="display: none;">
        <div class="max-w-4xl mx-auto p-6 sm:p-8 bg-background-base rounded-2xl card-shadow border-t-4 border-primary-dark">
            
            <h2 class="text-3xl font-bold text-primary-dark mb-6 border-b-2 border-accent-light pb-3">Personalizar e Gerar Relat√≥rio</h2>

            <!-- Formul√°rio de Personaliza√ß√£o (Sempre vis√≠vel nesta aba) -->
            <div id="feedback-customization-form" class="mb-8 space-y-4">
                <!-- Nome -->
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="feedback-name">Nome do(a) Avaliado(a):</label>
                    <input type="text" id="feedback-name" placeholder="Ex: Jo√£o Silva" class="input-box p-2 text-base">
                </div>
                <!-- Data e Score -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700" for="feedback-date">Data da Avalia√ß√£o:</label>
                        <input type="date" id="feedback-date" class="input-box p-2 text-base">
                    </div>
                    <!-- Campo de pontua√ß√£o final injetado pelo JS (Read-only) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700" for="final-score-display-form">Pontua√ß√£o Final:</label>
                        <input type="text" id="final-score-display-form" class="input-box p-2 text-base font-bold text-primary-dark bg-gray-100 cursor-default" readonly>
                    </div>
                </div>

                <!-- SE√á√ÉO: √äxitos Opcionais -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700" for="feedback-liminares">Liminares Deferidas (Opcional):</label>
                        <input type="number" id="feedback-liminares" placeholder="0" min="0" class="input-box p-2 text-base">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700" for="feedback-sentencas">Senten√ßas Favor√°veis (Opcional):</label>
                        <input type="number" id="feedback-sentencas" placeholder="0" min="0" class="input-box p-2 text-base">
                    </div>
                </div>

                <!-- Coment√°rios -->
                <div>
                    <label class="block text-sm font-medium text-gray-700" for="feedback-description">Coment√°rios do Avaliador (Texto principal do feedback):</label>
                    <textarea id="feedback-description" rows="5" class="input-box p-2 text-base" placeholder="Detalhe pontos fortes, √°reas de melhoria e pr√≥ximos passos..."></textarea>
                </div>
                <button onclick="generateReportContent()" class="w-full text-base font-bold text-white bg-status-bg-cumprido hover:bg-[#155a3c] transition-all duration-300 p-3 rounded-lg shadow-md main-button">
                    GERAR VISUALIZA√á√ÉO PR√âVIA
                </button>
            </div>

            <!-- Visualiza√ß√£o do Relat√≥rio (Conte√∫do injetado) -->
            <div id="report-preview-content" class="pt-8 border-t border-accent-light mt-4">
                <p class="text-center text-gray-500">Preencha o formul√°rio acima e clique em "GERAR VISUALIZA√á√ÉO PR√âVIA" para ver o relat√≥rio.</p>
            </div>
            
            <!-- Bot√µes de A√ß√£o do Relat√≥rio (Imprimir/Voltar) -->
            <div id="report-actions" class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 pt-4 border-t border-accent-light mt-8 print-hidden" style="display: none;">
                <button onclick="window.print()" class="flex-1 text-base font-bold text-white bg-primary-dark hover:bg-[#2e1010] p-3 rounded-lg shadow-md main-button">
                    Imprimir / Gerar PDF
                </button>
                <button onclick="showView('calculator-view')" class="flex-1 text-base font-bold text-primary-dark bg-accent-light hover:bg-[#c9b99e] p-3 rounded-lg shadow-md main-button">
                    Voltar para Calculadora
                </button>
            </div>
            
        </div>
    </div>
</div>

<script>
    // Dados dos indicadores de qualidade (Pilar 2) - ATUALIZADOS
    const INDICATORS = [
        { name: "Qualidade da Entrega (T√©cnica e Formal)", points: 13, id: "ind1" },
        { name: "Autogerenciamento (Organiza√ß√£o e Prioriza√ß√£o)", points: 13, id: "ind2" },
        { name: "Gest√£o de Prazo/Volume (Tarefas Imprevis√≠veis)", points: 8, id: "ind3" },
        { name: "Proatividade na Obten√ß√£o de Subs√≠dios", points: 8, id: "ind4" },
        { name: "Comunica√ß√£o de Dilig√™ncias (Reporte ao Cliente)", points: 8, id: "ind5" },
        { name: "Ades√£o ao Padr√£o M√≠nimo de Qualidade", points: 5, id: "ind6" },
        { name: "Volume de Dilig√™ncias Presenciais/Remotas", points: 5, id: "ind7" },
        { name: "Sucesso na Conquista de Andamentos", points: 3, id: "ind8" },
    ];
    
    // Soma total de pontos de Fibonacci dos Indicadores (PFT)
    // Calculado dinamicamente
    const PFT = INDICATORS.reduce((sum, ind) => sum + ind.points, 0); // Agora 63

    // Pesos fixos conforme a metodologia definida (60/40)
    const weightProd = 0.6; // Peso da Produtividade (Pilar 1)
    const weightIndic = 0.4; // Peso dos Indicadores (Pilar 2)
    
    // Vari√°veis globais para armazenar os scores e status
    let globalScoreProd = 0;
    let globalScoreIndic = 0;
    let finalPFDScore = 0;
    let finalPFDStatusText = '';
    let finalPFDStatusClass = ''; 
    
    // Objeto para armazenar os resultados dos indicadores (chave: id, valor: 0, 0.5, ou 1)
    const indicatorResults = {}; 

    /**
     * Alterna a visualiza√ß√£o entre as abas e atualiza o estado ativo dos bot√µes.
     */
    function showView(viewId) {
        // Oculta todas as views e remove a classe 'active'
        document.getElementById('calculator-view').style.display = 'none';
        document.getElementById('report-view').style.display = 'none';
        document.getElementById('tab-calculator').classList.remove('active');
        document.getElementById('tab-report').classList.remove('active');

        // Exibe a view selecionada e adiciona a classe 'active' ao bot√£o
        document.getElementById(viewId).style.display = 'block';
        document.getElementById(`tab-${viewId.replace('-view', '')}`).classList.add('active');

        // Se for para a aba de relat√≥rio, atualiza o campo de score
        if (viewId === 'report-view') {
             document.getElementById('final-score-display-form').value = `${(finalPFDScore * 100).toFixed(2)}%`;
        }
    }


    /**
     * Fun√ß√µes de C√°lculo (Mantidas)
     */
    function handleIndicatorChange(selectElement, indicatorId) {
        const value = parseFloat(selectElement.value);
        indicatorResults[indicatorId] = value;
        
        selectElement.classList.remove('border-tag-cumprido', 'text-tag-cumprido', 
                                      'border-tag-parcial', 'text-tag-parcial',
                                      'border-tag-falhou', 'text-tag-falhou');
        
        // Usa as cores definidas no Tailwind config
        if (value === 1) {
            selectElement.classList.add('border-tag-cumprido', 'text-tag-cumprido');
        } else if (value === 0.5) {
            selectElement.classList.add('border-tag-parcial', 'text-tag-parcial');
        } else {
            selectElement.classList.add('border-tag-falhou', 'text-tag-falhou');
        }
    }

    function initializeIndicatorsTable() {
        const tableBody = document.getElementById('indicator-table-body');
        tableBody.innerHTML = ''; 

        INDICATORS.forEach(indicator => {
            const initialValue = 0; 
            indicatorResults[indicator.id] = initialValue; 

            const row = document.createElement('tr');
            row.className = 'hover:bg-gray-50 transition duration-150 ease-in-out';
            
            row.innerHTML = `
                <td class="px-4 py-4 text-sm text-gray-800 font-medium w-2/3">${indicator.name} <span class="text-xs text-gray-500">(${indicator.points} pts)</span></td>
                <td class="px-4 py-4 whitespace-nowrap text-center flex items-center justify-center w-1/3">
                    <div class="custom-select-wrapper">
                        <select id="${indicator.id}-select" onchange="handleIndicatorChange(this, '${indicator.id}')" class="custom-select">
                            <option value="1">Cumprido</option>
                            <option value="0.5">Parcial</option>
                            <option value="0" selected>Falhou</option>
                        </select>
                        <div class="custom-select-icon">
                            <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </div>
                    </div>
                </td>
            `;
            tableBody.appendChild(row);

            // Aplica a cor inicial (Falhou)
            const selectElement = document.getElementById(`${indicator.id}-select`);
            handleIndicatorChange(selectElement, indicator.id);
        });
    }

    function calculateScoreProd(pg, msp) {
        if (msp <= 0) return 0;
        return Math.min(1.0, pg / msp);
    }

    function calculateScoreIndic() {
        let pontosGanhos = 0;
        let totalPontosFibonacci = PFT;  
        INDICATORS.forEach(indicator => {
            const result = indicatorResults[indicator.id] || 0; 
            pontosGanhos += indicator.points * result;
        });
        if (totalPontosFibonacci <= 0) return 0;
        return Math.min(1.0, pontosGanhos / totalPontosFibonacci);
    }

    function calculatePilar1() {
        const metaSemanal = parseFloat(document.getElementById('meta-semanal').value) || 0;
        const pontosGanhos = parseFloat(document.getElementById('pontos-ganhos').value) || 0;
        const scoreProd = calculateScoreProd(pontosGanhos, metaSemanal);
        globalScoreProd = scoreProd;
        document.getElementById('score-prod-display').textContent = `${(scoreProd * 100).toFixed(2)}%`;
    }

    function calculatePilar2() {
        const scoreIndic = calculateScoreIndic();    
        globalScoreIndic = scoreIndic;
        document.getElementById('score-indic-display').textContent = `${(scoreIndic * 100).toFixed(2)}%`;
    }


    /**
     * Fun√ß√£o final de C√°lculo.
     */
    function calculateFinal() {
        calculatePilar1();
        calculatePilar2();

        const pfdBox = document.getElementById('pfd-box');
        pfdBox.style.display = 'block';

        const pfd = (globalScoreProd * weightProd) + (globalScoreIndic * weightIndic);
        finalPFDScore = pfd;

        const pfdDisplay = document.getElementById('pfd-display');
        const pfdStatus = document.getElementById('pfd-status');
        const reportLinkInfo = document.getElementById('report-link-info');

        // Limpa classes anteriores
        pfdBox.classList.remove('bg-status-bg-cumprido', 'bg-primary-dark', 'bg-accent-light', 'bg-status-bg-falhou', 'bg-status-bg-parcial', 'text-white', 'text-gray-900', 'text-primary-dark', 'bg-status-bg-razoavel');

        // L√≥gica de cores e status
        if (pfd >= 0.95) {
            finalPFDStatusText = "‚úÖ CUMPRIDO: Performance Excepcional. Aproveitamento M√°ximo da meta de PFD.";
            finalPFDStatusClass = 'bg-status-bg-cumprido';
        } else if (pfd >= 0.85) {
            finalPFDStatusText = "‚≠ê √ìTIMO: Desempenho Forte e Consistente. Meta alcan√ßada com robustez.";
            finalPFDStatusClass = 'bg-primary-dark';
        } else if (pfd >= 0.70) {
            finalPFDStatusText = "‚ö†Ô∏è SATISFAT√ìRIO: Desempenho Parcial. Requer aten√ß√£o e ajuste em indicadores espec√≠ficos.";
            finalPFDStatusClass = 'bg-status-bg-parcial';
        } else if (pfd >= 0.60) {
            finalPFDStatusText = "üîÑ RAZO√ÅVEL: Desempenho M√≠nimo Aceit√°vel. Necessita melhoria urgente para atingir a meta.";
            finalPFDStatusClass = 'bg-status-bg-razoavel';
        } else {
            finalPFDStatusText = "‚ùå CR√çTICO: Desempenho Abaixo do M√≠nimo. Plano de a√ß√£o imediato requerido.";
            finalPFDStatusClass = 'bg-status-bg-falhou';
        }

        pfdStatus.textContent = finalPFDStatusText;
        pfdBox.classList.add(finalPFDStatusClass, 'text-white');
        pfdDisplay.textContent = `${(pfd * 100).toFixed(2)}%`;
        
        // Exibe a instru√ß√£o para mudar de aba e habilita o bot√£o de relat√≥rio.
        reportLinkInfo.style.display = 'block';
    }

    /**
     * Gera o conte√∫do do relat√≥rio no painel de visualiza√ß√£o da aba Relat√≥rio.
     * ATUALIZADO para incluir a tabela de indicadores.
     */
    function generateReportContent() {
        if (finalPFDScore === 0 && document.getElementById('meta-semanal').value === "0") {
            document.getElementById('report-preview-content').innerHTML = `
                <div class="p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg">
                    üö® **Erro:** Por favor, clique em "CALCULAR AVALIA√á√ÉO FINAL" na aba "Calculadora" antes de gerar o relat√≥rio.
                </div>
            `;
            document.getElementById('report-actions').style.display = 'none';
            return;
        }

        const nome = document.getElementById('feedback-name').value || 'N√£o Informado';
        const dateInput = document.getElementById('feedback-date').value;
        // Ajuste para lidar com fuso hor√°rio na data
        const data = dateInput ? new Date(dateInput + "T00:00:00").toLocaleDateString('pt-BR') : new Date().toLocaleDateString('pt-BR');
        const descricao = document.getElementById('feedback-description').value || 'Nenhum coment√°rio detalhado foi fornecido.';
        const score = `${(finalPFDScore * 100).toFixed(2)}%`;

        // NOVOS CAMPOS OPCIONAIS
        const liminares = document.getElementById('feedback-liminares').value;
        const sentencas = document.getElementById('feedback-sentencas').value;

        let statusTextColor = 'text-gray-800';
        if (finalPFDStatusClass === 'bg-status-bg-cumprido') {
            statusTextColor = 'text-tag-cumprido';
        } else if (finalPFDStatusClass === 'bg-primary-dark') {
            statusTextColor = 'text-primary-dark';
        } else if (finalPFDStatusClass === 'bg-status-bg-parcial') {
            statusTextColor = 'text-tag-parcial';
        } else if (finalPFDStatusClass === 'bg-status-bg-razoavel') {
            statusTextColor = 'text-status-bg-razoavel';
        } else if (finalPFDStatusClass === 'bg-status-bg-falhou') {
            statusTextColor = 'text-tag-falhou';
        }

        // --- IN√çCIO: Se√ß√£o Opcional de √äxitos ---
        let successDetailsHTML = '';
        // Verifica se os campos t√™m valores num√©ricos maiores que 0
        const liminaresNum = parseInt(liminares, 10);
        const sentencasNum = parseInt(sentencas, 10);

        if (liminaresNum > 0 || sentencasNum > 0) { // Se um dos campos tiver valor
            successDetailsHTML = `
                <h3 class="text-xl font-bold text-primary-dark mb-3 mt-6">√äxitos da Semana:</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            `;

            if (liminaresNum > 0) {
                successDetailsHTML += `
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600">Liminares Deferidas:</p>
                        <p class="text-xl font-bold text-tag-cumprido">${liminaresNum}</p>
                    </div>
                `;
            }
            if (sentencasNum > 0) {
                 successDetailsHTML += `
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200">
                        <p class="text-sm text-gray-600">Senten√ßas Favor√°veis:</p>
                        <p class="text-xl font-bold text-tag-cumprido">${sentencasNum}</p>
                    </div>
                `;
            }

             successDetailsHTML += `
                </div>
            `;
        }
        // --- FIM: Se√ß√£o Opcional de √äxitos ---


        // --- IN√çCIO: Se√ß√£o de Detalhamento dos Indicadores ---
        let indicatorDetailsHTML = `
            <h3 class="text-xl font-bold text-primary-dark mb-3 mt-6">Detalhamento dos Indicadores de Qualidade:</h3>
            <div class="overflow-hidden border border-gray-200 rounded-lg">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Indicador</th>
                            <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Resultado</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
        `;

        INDICATORS.forEach(indicator => {
            const resultValue = indicatorResults[indicator.id];
            let resultText = "Falhou";
            let resultClass = "text-tag-falhou"; // Usa as cores da config

            if (resultValue === 1) {
                resultText = "Cumprido";
                resultClass = "text-tag-cumprido";
            } else if (resultValue === 0.5) {
                resultText = "Parcial";
                resultClass = "text-tag-parcial";
            }

            indicatorDetailsHTML += `
                <tr>
                    <td class="px-4 py-3 text-sm text-gray-800">${indicator.name} <span class="text-xs text-gray-500">(${indicator.points} pts)</span></td>
                    <td class="px-4 py-3 text-sm font-bold text-right ${resultClass}">${resultText}</td>
                </tr>
            `;
        });

        indicatorDetailsHTML += `
                    </tbody>
                </table>
            </div>
        `;
        // --- FIM: Se√ß√£o de Detalhamento dos Indicadores ---


        // --- HTML FINAL DO RELAT√ìRIO (Atualizado) ---
        const reportHTML = `
            <div class="space-y-6">
                <!-- CABE√áALHO MODERNO (Com Branding) -->
                <div class="flex justify-between items-center border-b-2 border-primary-dark/30 pb-2 mb-4">
                    <h3 class="text-2xl font-extrabold text-primary-dark">Relat√≥rio de Desempenho</h3>
                    <span class="text-lg font-semibold text-primary-dark">Spencer Advogados</span>
                </div>

                <!-- LINHA DE DADOS PRINCIPAIS (Nome, Data, Pontua√ß√£o/Status) -->
                <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 border-b border-accent-light pb-4 pt-2">
                    <!-- NOME -->
                    <div class="border-l-4 border-primary-dark/50 pl-3">
                        <p class="text-xs text-gray-500">Avaliado(a):</p>
                        <p class="text-lg font-semibold text-gray-900">${nome}</p>
                    </div>
                    <!-- DATA -->
                    <div class="border-l-4 border-primary-dark/50 pl-3">
                        <p class="text-xs text-gray-500">Data da Avalia√ß√£o:</p>
                        <p class="text-lg font-semibold text-gray-900">${data}</p>
                    </div>
                    <!-- PONTUA√á√ÉO E CLASSIFICA√á√ÉO -->
                    <div class="border-l-4 border-primary-dark/50 pl-3">
                        <p class="text-xs text-gray-500">Score PFD e Status:</p>
                        <p class="text-2xl font-extrabold ${statusTextColor}">${score}</p>
                        <p class="text-sm text-gray-700 font-medium">${finalPFDStatusText.replace(/[\u2705\u2b50\u26a0\u2716\u1F504]/g, '')}</p> 
                    </div>
                </div>

                <!-- INJETAR √äXITOS OPCIONAIS AQUI -->
                ${successDetailsHTML}

                <!-- INJETAR DETALHES DO INDICADOR AQUI -->
                ${indicatorDetailsHTML}

                <!-- COMENT√ÅRIOS -->
                <div>
                    <h3 class="text-xl font-bold text-primary-dark mb-3 mt-6">Coment√°rios do Avaliador:</h3>
                    <div class="p-4 bg-gray-50 rounded-lg border border-gray-200 whitespace-pre-wrap text-base leading-relaxed">
                        ${descricao}
                    </div>
                </div>
            </div>
        `;

        // Injeta o HTML e exibe os bot√µes de a√ß√£o do relat√≥rio
        document.getElementById('report-preview-content').innerHTML = reportHTML;
        document.getElementById('report-actions').style.display = 'flex';
        
        // Rola a aba de relat√≥rio para o topo, onde a pr√©-visualiza√ß√£o aparece
        document.getElementById('report-view').scrollTop = 0;
    }

    /**
     * Reseta todos os campos e retorna para a aba Calculadora.
     */
    function resetAll() {
        // Resetar Pilares 1, 2 e scores
        document.getElementById('meta-semanal').value = 0;
        document.getElementById('pontos-ganhos').value = 0;
        document.getElementById('score-prod-display').textContent = '--%';
        document.getElementById('score-indic-display').textContent = '--%';
        globalScoreProd = 0;
        globalScoreIndic = 0;
        finalPFDScore = 0;
        finalPFDStatusText = '';

        INDICATORS.forEach(indicator => {
            const selectElement = document.getElementById(`${indicator.id}-select`);
            if (selectElement) {
                selectElement.value = "0";
                handleIndicatorChange(selectElement, indicator.id); 
            }
        });

        // Resetar e Ocultar Resultado Final (Calculadora)
        document.getElementById('pfd-box').style.display = 'none';
        document.getElementById('report-link-info').style.display = 'none';
        
        // Resetar campos de Feedback
        document.getElementById('feedback-name').value = '';
        const dateField = document.getElementById('feedback-date');
        if (dateField) {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateField.value = `${yyyy}-${mm}-${dd}`;
        }
        document.getElementById('feedback-description').value = '';
        document.getElementById('final-score-display-form').value = '';

        // NOVO: Resetar campos de √™xitos
        document.getElementById('feedback-liminares').value = '';
        document.getElementById('feedback-sentencas').value = '';

        // Resetar pr√©-visualiza√ß√£o do relat√≥rio
        document.getElementById('report-preview-content').innerHTML = '<p class="text-center text-gray-500">Preencha o formul√°rio acima e clique em "GERAR VISUALIZA√á√ÉO PR√âVIA" para ver o relat√≥rio.</p>';
        document.getElementById('report-actions').style.display = 'none';
        
        // Volta para a Aba Calculadora
        showView('calculator-view');
    }

    // Executar inicializa√ß√£o ao carregar a p√°gina
    window.onload = () => {
        initializeIndicatorsTable();
        resetAll();
        showView('calculator-view'); // Garante que a calculadora √© a primeira aba
    };
</script>
</body>
</html>
